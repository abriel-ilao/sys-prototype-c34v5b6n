!function(t){var i=function(i,s){this.$element=t(i),this.options=s;var o=this;this.pr=s.pointRadii,this.rr=s.roundRadii,this.o=s.space,this.color=s.color,this.$element.css({position:"relation",width:this.options.width,height:this.options.height,"background-color":s.backgroundColor,overflow:"hidden",cursor:"default"}),t(i).attr("id")||t(i).attr("id",(65535*Math.random()).toString()),this.id="#"+t(i).attr("id");var h=function(t,i){this.x=t,this.y=i};this.result="",this.pList=[],this.sList=[],this.tP=new h(0,0),this.$element.append('<canvas class="main-c" width="'+s.width+'" height="'+s.height+'" >'),this.$c=t(this.id+" .main-c")[0],this.$ctx=this.$c.getContext("2d"),this.initDraw=function(){this.$ctx.strokeStyle=this.color,this.$ctx.lineWidth=2;for(var t=0;t<3;t++)for(var i=0;i<3;i++){this.$ctx.moveTo(this.o/2+2*this.rr+i*(this.o+2*this.rr),this.o/2+this.rr+t*(this.o+2*this.rr)),this.$ctx.arc(this.o/2+this.rr+i*(this.o+2*this.rr),this.o/2+this.rr+t*(this.o+2*this.rr),this.rr,0,2*Math.PI);var s=new h(this.o/2+this.rr+i*(this.o+2*this.rr),this.o/2+this.rr+t*(this.o+2*this.rr));o.pList.length<9&&this.pList.push(s)}this.$ctx.stroke(),this.initImg=this.$ctx.getImageData(0,0,this.options.width,this.options.height)},this.initDraw(),this.isIn=function(t,i){for(var s in o.pList)if(Math.pow(t-o.pList[s].x,2)+Math.pow(i-o.pList[s].y,2)<Math.pow(this.rr,2))return o.pList[s];return 0},this.pointDraw=function(t){arguments.length>0&&(o.$ctx.strokeStyle=t,o.$ctx.fillStyle=t);for(var i in o.sList)o.$ctx.moveTo(o.sList[i].x+o.pr,o.sList[i].y),o.$ctx.arc(o.sList[i].x,o.sList[i].y,o.pr,0,2*Math.PI),o.$ctx.fill()},this.lineDraw=function(t){if(arguments.length>0&&(o.$ctx.strokeStyle=t,o.$ctx.fillStyle=t),o.sList.length>0)for(var i in o.sList)0!=i?o.$ctx.lineTo(o.sList[i].x,o.sList[i].y):o.$ctx.moveTo(o.sList[i].x,o.sList[i].y)},this.allDraw=function(t){arguments.length>0?(this.pointDraw(t),this.lineDraw(t),o.$ctx.stroke()):(this.pointDraw(),this.lineDraw())},this.draw=function(t,i){o.$ctx.clearRect(0,0,o.options.width,o.options.height),o.$ctx.beginPath(),o.$ctx.putImageData(this.initImg,0,0),o.$ctx.lineWidth=4,o.pointDraw(o.options.lineColor),o.lineDraw(o.options.lineColor),o.$ctx.lineTo(t,i),o.$ctx.stroke()},this.pointInList=function(t,i){for(var s in i)if(t.x==i[s].x&&t.y==i[s].y)return++s;return!1},this.touched=!1,t(this.id).on("mousedown touchstart",{that:o},function(t){t.data.that.touched=!0}),t(this.id).on("mouseup touchend",{that:o},function(s){s.data.that.touched=!1,o.$ctx.clearRect(0,0,o.options.width,o.options.height),o.$ctx.beginPath(),o.$ctx.putImageData(s.data.that.initImg,0,0),o.allDraw(o.options.lineColor);for(var h in o.sList)s.data.that.pointInList(o.sList[h],s.data.that.pList)&&(s.data.that.result=s.data.that.result+s.data.that.pointInList(o.sList[h],s.data.that.pList).toString());t(i).trigger("hasPasswd",o.result)}),t(this.id).on("touchmove mousemove",{that:o},function(t){if(t.data.that.touched){var i=t.pageX||t.originalEvent.targetTouches[0].pageX,s=t.pageY||t.originalEvent.targetTouches[0].pageY;i-=o.$element.offset().left,s-=o.$element.offset().top;var h=t.data.that.isIn(i,s);0!=h&&(t.data.that.pointInList(h,t.data.that.sList)||t.data.that.sList.push(h)),t.data.that.draw(i,s)}}),t(this.id).on("passwdWrong",{that:o},function(t){o.$ctx.clearRect(0,0,o.options.width,o.options.height),o.$ctx.beginPath(),o.$ctx.putImageData(o.initImg,0,0),o.allDraw("#cc1c21"),o.result="",o.pList=[],o.sList=[],setTimeout(function(){o.$ctx.clearRect(0,0,o.options.width,o.options.height),o.$ctx.beginPath(),o.initDraw()},500)}),t(this.id).on("passwdRight",{that:o},function(t){o.$ctx.clearRect(0,0,o.options.width,o.options.height),o.$ctx.beginPath(),o.$ctx.putImageData(o.initImg,0,0),o.allDraw("#00a254"),o.result="",o.pList=[],o.sList=[],setTimeout(function(){o.$ctx.clearRect(0,0,o.options.width,o.options.height),o.$ctx.beginPath(),o.initDraw()},500)})};i.DEFAULTS={zindex:100,roundRadii:25,pointRadii:6,space:30,width:240,height:240,lineColor:"#00aec7",backgroundColor:"#252736",color:"#FFFFFF"},t.fn.GesturePasswd=function(s,o){return this.each(function(){var h=t(this),a=t.extend({},i.DEFAULTS,"object"==typeof s&&s),n=h.data("GesturePasswd"),e="string"==typeof s?s:NaN;n||h.data("danmu",n=new i(this,a)),e&&n[e](o)})},t.fn.GesturePasswd.Constructor=i}(jQuery);